
!------------------------------------------------------------------------!
!  The Community Multiscale Air Quality (CMAQ) system software is in     !
!  continuous development by various groups and is based on information  !
!  from these groups: Federal Government employees, contractors working  !
!  within a United States Government contract, and non-Federal sources   !
!  including research institutions.  These groups give the Government    !
!  permission to use, prepare derivative works of, and distribute copies !
!  of their work in the CMAQ system to the public and to permit others   !
!  to do so.  The United States Environmental Protection Agency          !
!  therefore grants similar permission to use the CMAQ system software,  !
!  but users are requested to provide copies of derivative works or      !
!  products designed to operate in the CMAQ system to the United States  !
!  Government without restrictions as to use by others.  Software        !
!  that is used with the CMAQ system but distributed under the GNU       !
!  General Public License or the GNU Lesser General Public License is    !
!  subject to their copyright restrictions.                              !
!------------------------------------------------------------------------!

C RCS file, release, date & time of last delta, author, state, [and locker]
C $Header$

C what(1) key, module and SID; SCCS file; date and time of last delta:
C %W% %P% %G% %U%

      SUBROUTINE HRCALC_SS

C***********************************************************************
C
C  FUNCTION: To calculate concentrations of steady-state species 
C
R1  PRECONDITIONS: For SAPRC99 family of mechanisms
C
C  KEY SUBROUTINES/FUNCTIONS CALLED: None
C
R2  REVISION HISTORY: Prototype created by Jerry Gipson, June, 2009
C
C***********************************************************************
      USE HRDATA

      IMPLICIT NONE

C.....INCLUDES: NONE
 
C.....ARGUMENTS: NONE 

C.....PARAMETERS: NONE

C.....EXTERNAL FUNCTIONS: NONE

C.....SAVED VARIABLES:

      CHARACTER( 16 ), SAVE  ::  PNAME = 'HRCALC_SSA'   ! Program name

      REAL, SAVE ::  MINLOSS = 1.0E-30   ! Min value of loss freq
      REAL, SAVE ::  MINCONC = 1.0E-30   ! Min concentration value


C.....LOCAL VARIABLES:

      REAL       ::  SS_PROD            ! Production of SS species
      REAL       ::  SS_LFRQ            ! Loss frequency of SS species

C***********************************************************************


ccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccc
c  This subroutine calculates concentrations of all species designated
c  to be in steady-state and then updates the reaction rates of all
c  reactions that have the steady-state species as a reactant using the
c  computed concentration. Steady-state concentrations are computed as
c  follows. Start with the ODE for any species concentration:
c      dCi/dt = Pi - LiCi
c  where
c      Ci = Concentration of species i
c      Pi = Production of species i
c      Li = Loss frequency of species i 
c      t  = time
c  For species i to be in steady-state, dCi/dt = 0; so
c     (Ci)ss = Pi / Li
c  In the code below, the production is computed as the product of
c  the stoichiometric coefficient and the reaction rate for any reaction
c  in which a steady state species is produced.  The order of the 
c  species calculations in the code was pre-determined in the CHEMMECH
c  processor to resolve possible steady-state dependencies (i.e., one
c  steady-state species being produced by another). Also, the CHEMMECH
c  processor does not allow any steady-state species to react with itself.
cccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccc
S1



cccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccc
c  SS Species: xOH             
cccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccc

      SS_PROD =   0.012 * RXRAT( NCELL, 156 )      ! ROOH+OH=0.012*xOH+...
     &         +  0.041 * RXRAT( NCELL, 158 )      ! R6OOH+OH=0.041*xOH+...
     &         +  0.024 * RXRAT( NCELL, 160 )      ! RAOOH+OH=0.024*xOH+...
     &         +  0.020 * RXRAT( NCELL, 211 )      ! CCOOOH+OH=0.02*xOH+...
     &         +  0.110 * RXRAT( NCELL, 213 )      ! RCOOOH+OH=0.11*xOH+...
     &         +  0.104 * RXRAT( NCELL, 352 )      ! ROOH+CL=0.104*xOH+0.414*OH+...
     &         +  0.502 * RXRAT( NCELL, 353 )      ! R6OOH+CL=0.502*xOH+...
     &         +  0.024 * RXRAT( NCELL, 354 )      ! RAOOH+CL=0.024*xOH+...

      SS_LFRQ =           RKI( NCELL,  120 )                            ! xOH=OH
     &         +          RKI( NCELL,  121 )                            ! xOH=

c..compute steady-state concentration
      IF( SS_LFRQ .LE. 0.0 ) SS_LFRQ = MNLOSS
      YC( NCELL, xOH ) = SS_PROD / SS_LFRQ
      YC( NCELL, xOH ) = MAX( YC( NCELL, xOH ), MINCONC )

c..update reaction rates with the computed SS species conc 
      RXRAT( NCELL,  120 ) = RKI( NCELL,   120 ) * YC( NCELL, xOH )
      RXRAT( NCELL,  121 ) = RKI( NCELL,   121 ) * YC( NCELL, xOH )


cccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccc
c  SS Species: xHO2            
cccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccc

      SS_PROD =   0.500 * RXRAT( NCELL,  59 )      ! RO2C+MEO2=0.5*xHO2+...
     &         +  0.500 * RXRAT( NCELL,  64 )      ! RO2XC+MEO2=0.5*xHO2+...
     &         +  0.400 * RXRAT( NCELL,  79 )      ! PAN2=0.4*xHO2+0.6*NO2+...
     &         +          RXRAT( NCELL,  80 )      ! RCO3+NO=xHO2+RO2C+NO2+...
     &         +          RXRAT( NCELL,  82 )      ! RCO3+NO3=xHO2+RO2C+NO2+...
     &         +          RXRAT( NCELL,  86 )      ! RCO3+MECO3=xHO2+MEO2+RO2C+...
     &         +  2.000 * RXRAT( NCELL,  87 )      ! RCO3+RCO3=2*xHO2+2*RO2C+...
     &         +          RXRAT( NCELL,  98 )      ! BZCO3+RCO3=xHO2+RO2C+2*CO2+...
     &         +          RXRAT( NCELL, 110 )      ! MACO3+RCO3=xHO2+MECO3+RO2C+...
     &         +          RXRAT( NCELL, 117 )      ! BZO=xHO2+RO2C+CRES
     &         +  0.035 * RXRAT( NCELL, 143 )      ! RCHO+OH=0.035*xHO2+...
     &         +          RXRAT( NCELL, 144 )      ! RCHO=xHO2+RO2C+yROOH+xCCHO+...
     &         +  0.376 * RXRAT( NCELL, 148 )      ! MEK+OH=0.376*xHO2+...
     &         +          RXRAT( NCELL, 149 )      ! MEK=xHO2+RO2C+MECO3+xCCHO+...
     &         +  0.491 * RXRAT( NCELL, 152 )      ! CCOOH+OH=0.491*xHO2+...
     &         +          RXRAT( NCELL, 153 )      ! RCOOH+OH=xHO2+RO2C+...
     &         +  0.239 * RXRAT( NCELL, 156 )      ! ROOH+OH=0.239*xHO2+...
     &         +  0.090 * RXRAT( NCELL, 158 )      ! R6OOH+OH=0.09*xHO2+...
     &         +  0.782 * RXRAT( NCELL, 159 )      ! R6OOH=0.782*xHO2+0.142*HO2+...
     &         +  0.565 * RXRAT( NCELL, 160 )      ! RAOOH+OH=0.565*xHO2+...
     &         +  0.800 * RXRAT( NCELL, 170 )      ! CRES+OH=0.8*xHO2+0.8*RO2C+...
     &         +  0.521 * RXRAT( NCELL, 178 )      ! AFG1+OH=0.521*xHO2+...
     &         +  0.521 * RXRAT( NCELL, 181 )      ! AFG2+OH=0.521*xHO2+...
     &         +  0.561 * RXRAT( NCELL, 184 )      ! AFG3+OH=0.561*xHO2+...
     &         +  0.095 * RXRAT( NCELL, 185 )      ! AFG3+O3=0.095*xHO2+...
     &         +  0.500 * RXRAT( NCELL, 186 )      ! MACR+OH=0.5*xHO2+0.5*RO2C+...
     &         +  0.500 * RXRAT( NCELL, 188 )      ! MACR+NO3=0.5*xHO2+0.5*RO2C+...
     &         +  0.300 * RXRAT( NCELL, 191 )      ! MVK+OH=0.3*xHO2+...
     &         +  0.050 * RXRAT( NCELL, 192 )      ! MVK+O3=0.05*xHO2+0.064*HO2+...
     &         +  0.670 * RXRAT( NCELL, 195 )      ! IPRD+OH=0.67*xHO2+...
     &         +  0.799 * RXRAT( NCELL, 197 )      ! IPRD+NO3=0.799*xHO2+...
     &         +  0.379 * RXRAT( NCELL, 199 )      ! PRD2+OH=0.379*xHO2+...
     &         +  0.913 * RXRAT( NCELL, 200 )      ! PRD2=0.913*xHO2+0.4*MECO3+...
     &         +  0.305 * RXRAT( NCELL, 201 )      ! RNO3+OH=0.305*xHO2+...
     &         +  0.554 * RXRAT( NCELL, 202 )      ! RNO3=0.554*xHO2+0.344*HO2+...
     &         +  0.250 * RXRAT( NCELL, 206 )      ! ACROLEIN+OH=0.25*xHO2+...
     &         +  0.031 * RXRAT( NCELL, 208 )      ! ACROLEIN+NO3=0.031*xHO2+...
     &         +  0.084 * RXRAT( NCELL, 213 )      ! RCOOOH+OH=0.084*xHO2+...
     &         +          RXRAT( NCELL, 214 )      ! RCOOOH=xHO2+xCCHO+yROOH+CO2+OH
     &         +          RXRAT( NCELL, 266 )      ! ETHENE+OH=xHO2+RO2C+...
     &         +          RXRAT( NCELL, 268 )      ! ETHENE+NO3=xHO2+RO2C+xRCHO+...
     &         +  0.290 * RXRAT( NCELL, 269 )      ! ETHENE+O3P=0.29*xHO2+...
     &         +  0.984 * RXRAT( NCELL, 270 )      ! PROPENE+OH=0.984*xHO2+...
     &         +  0.949 * RXRAT( NCELL, 272 )      ! PROPENE+NO3=0.949*xHO2+...
     &         +  0.951 * RXRAT( NCELL, 274 )      ! BUTADIENE13+OH=0.951*xHO2+...
     &         +  0.815 * RXRAT( NCELL, 276 )      ! BUTADIENE13+NO3=0.815*xHO2+...
     &         +  0.117 * RXRAT( NCELL, 277 )      ! BUTADIENE13+O3P=0.117*xHO2+...
     &         +  0.907 * RXRAT( NCELL, 278 )      ! ISOPRENE+OH=0.907*xHO2+...
     &         +  0.749 * RXRAT( NCELL, 280 )      ! ISOPRENE+NO3=0.749*xHO2+...
     &         +  0.799 * RXRAT( NCELL, 282 )      ! APIN+OH=0.799*xHO2+...
     &         +  0.102 * RXRAT( NCELL, 283 )      ! APIN+O3=0.102*xHO2+...
     &         +  0.056 * RXRAT( NCELL, 284 )      ! APIN+NO3=0.056*xHO2+...
     &         +  0.290 * RXRAT( NCELL, 288 )      ! BENZENE+OH=0.29*xHO2+...
     &         +  0.454 * RXRAT( NCELL, 289 )      ! TOLUENE+OH=0.454*xHO2+...
     &         +  0.520 * RXRAT( NCELL, 290 )      ! MXYL+OH=0.52*xHO2+...
     &         +  0.554 * RXRAT( NCELL, 291 )      ! OXYL+OH=0.554*xHO2+...
     &         +  0.487 * RXRAT( NCELL, 292 )      ! PXYL+OH=0.487*xHO2+...
     &         +  0.627 * RXRAT( NCELL, 293 )      ! TRIMETH_BENZ124+OH=...
     &         +  0.050 * RXRAT( NCELL, 294 )      ! ETOH+OH=0.05*xHO2+0.95*HO2+...
     &         +          RXRAT( NCELL, 295 )      ! ALK1+OH=xHO2+RO2C+xCCHO+yROOH
     &         +  0.965 * RXRAT( NCELL, 296 )      ! ALK2+OH=0.965*xHO2+...
     &         +  0.695 * RXRAT( NCELL, 297 )      ! ALK3+OH=0.695*xHO2+...
     &         +  0.830 * RXRAT( NCELL, 298 )      ! ALK4+OH=0.83*xHO2+...
     &         +  0.647 * RXRAT( NCELL, 299 )      ! ALK5+OH=0.647*xHO2+...
     &         +  0.871 * RXRAT( NCELL, 300 )      ! OLE1+OH=0.871*xHO2+...
     &         +  0.057 * RXRAT( NCELL, 301 )      ! OLE1+O3=0.057*xHO2+...
     &         +  0.772 * RXRAT( NCELL, 302 )      ! OLE1+NO3=0.772*xHO2+...
     &         +  0.912 * RXRAT( NCELL, 304 )      ! OLE2+OH=0.912*xHO2+...
     &         +  0.041 * RXRAT( NCELL, 305 )      ! OLE2+O3=0.041*xHO2+...
     &         +  0.400 * RXRAT( NCELL, 306 )      ! OLE2+NO3=0.4*xHO2+...
     &         +  0.566 * RXRAT( NCELL, 308 )      ! ARO1+OH=0.566*xHO2+...
     &         +  0.617 * RXRAT( NCELL, 309 )      ! ARO2+OH=0.617*xHO2+...
     &         +  0.734 * RXRAT( NCELL, 310 )      ! TERP+OH=0.734*xHO2+...
     &         +  0.046 * RXRAT( NCELL, 311 )      ! TERP+O3=0.046*xHO2+...
     &         +  0.227 * RXRAT( NCELL, 312 )      ! TERP+NO3=0.227*xHO2+...
     &         +  0.734 * RXRAT( NCELL, 314 )      ! SESQ+OH=0.734*xHO2+...
     &         +  0.046 * RXRAT( NCELL, 315 )      ! SESQ+O3=0.046*xHO2+...
     &         +  0.227 * RXRAT( NCELL, 316 )      ! SESQ+NO3=0.227*xHO2+...
     &         +  0.100 * RXRAT( NCELL, 343 )      ! RCHO+CL=0.1*xHO2+0.9*RCO3+...
     &         +  0.840 * RXRAT( NCELL, 345 )      ! MEK+CL=0.84*xHO2+...
     &         +  0.547 * RXRAT( NCELL, 346 )      ! RNO3+CL=0.547*xHO2+...
     &         +  0.541 * RXRAT( NCELL, 347 )      ! PRD2+CL=0.541*xHO2+...
     &         +          RXRAT( NCELL, 350 )      ! CRES+CL=xHO2+HCL+xBALD+yR6OOH
     &         +  0.482 * RXRAT( NCELL, 352 )      ! ROOH+CL=0.482*xHO2+...
     &         +  0.237 * RXRAT( NCELL, 353 )      ! R6OOH+CL=0.237*xHO2+...
     &         +  0.565 * RXRAT( NCELL, 354 )      ! RAOOH+CL=0.565*xHO2+...
     &         +  0.484 * RXRAT( NCELL, 355 )      ! ACROLEIN+CL=0.484*xHO2+...
     &         +  0.802 * RXRAT( NCELL, 356 )      ! MACR+CL=0.802*xHO2+...
     &         +  0.322 * RXRAT( NCELL, 357 )      ! MVK+CL=0.322*xHO2+...
     &         +  0.712 * RXRAT( NCELL, 358 )      ! IPRD+CL=0.712*xHO2+...
     &         +          RXRAT( NCELL, 370 )      ! ETHENE+CL=xHO2+2*RO2C+...
     &         +  0.971 * RXRAT( NCELL, 371 )      ! PROPENE+CL=0.971*xHO2+...
     &         +  0.390 * RXRAT( NCELL, 372 )      ! BUTADIENE13+CL=0.39*xHO2+...
     &         +  0.738 * RXRAT( NCELL, 373 )      ! ISOPRENE+CL=0.738*xHO2+...
     &         +  0.252 * RXRAT( NCELL, 374 )      ! APIN+CL=0.252*xHO2+...
     &         +  0.894 * RXRAT( NCELL, 376 )      ! TOLUENE+CL=0.894*xHO2+...
     &         +  0.864 * RXRAT( NCELL, 377 )      ! MXYL+CL=0.864*xHO2+...
     &         +  0.864 * RXRAT( NCELL, 378 )      ! OXYL+CL=0.864*xHO2+...
     &         +  0.864 * RXRAT( NCELL, 379 )      ! PXYL+CL=0.864*xHO2+...
     &         +  0.838 * RXRAT( NCELL, 380 )      ! TRIMETH_BENZ124+CL=...
     &         +  0.312 * RXRAT( NCELL, 381 )      ! ETOH+CL=0.312*xHO2+...
     &         +          RXRAT( NCELL, 382 )      ! ALK1+CL=xHO2+HCL+RO2C+...
     &         +  0.970 * RXRAT( NCELL, 383 )      ! ALK2+CL=0.97*xHO2+HCL+...
     &         +  0.835 * RXRAT( NCELL, 384 )      ! ALK3+CL=0.835*xHO2+HCL+...
     &         +  0.827 * RXRAT( NCELL, 385 )      ! ALK4+CL=0.827*xHO2+HCL+...
     &         +  0.647 * RXRAT( NCELL, 386 )      ! ALK5+CL=0.647*xHO2+HCL+...
     &         +  0.873 * RXRAT( NCELL, 387 )      ! OLE1+CL=0.873*xHO2+...
     &         +  0.450 * RXRAT( NCELL, 388 )      ! OLE2+CL=0.45*xHO2+...
     &         +  0.840 * RXRAT( NCELL, 389 )      ! ARO1+CL=0.84*xHO2+...
     &         +  0.828 * RXRAT( NCELL, 390 )      ! ARO2+CL=0.828*xHO2+...
     &         +  0.252 * RXRAT( NCELL, 391 )      ! TERP+CL=0.252*xHO2+...
     &         +  0.252 * RXRAT( NCELL, 392 )      ! SESQ+CL=0.252*xHO2+...

      SS_LFRQ =           RKI( NCELL,  118 )                            ! xHO2=HO2
     &         +          RKI( NCELL,  119 )                            ! xHO2=

c..compute steady-state concentration
      IF( SS_LFRQ .LE. 0.0 ) SS_LFRQ = MNLOSS
      YC( NCELL, xHO2 ) = SS_PROD / SS_LFRQ
      YC( NCELL, xHO2 ) = MAX( YC( NCELL, xHO2 ), MINCONC )

c..update reaction rates with the computed SS species conc 
      RXRAT( NCELL,  118 ) = RKI( NCELL,   118 ) * YC( NCELL, xHO2 )
      RXRAT( NCELL,  119 ) = RKI( NCELL,   119 ) * YC( NCELL, xHO2 )

      RETURN

      END
